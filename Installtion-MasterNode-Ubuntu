Imp folder that needs required reguler backup : /var/lib/etcd/  & /etc/kubernetes/manifests/

kubeadm reset -f # to reset the cluster
kubeadm reset -f
rm -rf /etc/cni /opt/cni /var/lib/cni /var/lib/kubelet /etc/kubernetes
##Generate a New Join Command on Master
Run this on master1:
kubeadm token create --print-join-command

## Delete the nodes from cluster
kubectl delete node ip-10-150-50-40
kubectl delete node ip-10-150-50-86

Drain the node (optional but safe)
Only do this if the node was previously running workloads. If it's already NotReady, you can skip to step 2.
kubectl drain ip-10-150-50-40 --ignore-daemonsets --delete-emptydir-data --force
kubectl drain ip-10-150-50-86 --ignore-daemonsets --delete-emptydir-data --force
## --force is required because the node is NotReady.



Installation

Master Nodes:

api
etcd
scheduler
controller

installation tools/utility/scripts:
  
1. kubeadm
2. ansible
3. KOPS
4. kubespray

Step-1: kubeadm utility
Step-2: cri-o
Step-3: kubelet
Step-4: start the api/controller/etct/scheduler

Refer the website for installation : https://cri-o.io/

Step-1 :	Define the Kubernetes version and used CRI-O stream
KUBERNETES_VERSION=v1.32
CRIO_VERSION=v1.32


Step-2 :	Bootstrap a cluster (Pre-Requites)
swapoff -a
modprobe br_netfilter
sysctl -w net.ipv4.ip_forward=1
 




Step-3 :  Add the Kubernetes repository

curl -fsSL https://pkgs.k8s.io/core:/stable:/$KUBERNETES_VERSION/deb/Release.key |
    gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg

echo "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/$KUBERNETES_VERSION/deb/ /" |
    tee /etc/apt/sources.list.d/kubernetes.list

Add the CRI-O repository:

curl -fsSL https://download.opensuse.org/repositories/isv:/cri-o:/stable:/$CRIO_VERSION/deb/Release.key |
    gpg --dearmor -o /etc/apt/keyrings/cri-o-apt-keyring.gpg

echo "deb [signed-by=/etc/apt/keyrings/cri-o-apt-keyring.gpg] https://download.opensuse.org/repositories/isv:/cri-o:/stable:/$CRIO_VERSION/deb/ /" |
    tee /etc/apt/sources.list.d/cri-o.list


Step-4 : Install

apt-get update -y
apt-get install -y cri-o kubelet kubeadm kubectl



systemctl start crio
systemctl start kubelet


systemctl status cri-o
systemctl status cri-o kubelet

systemctl is-active kubelet
systemctl is-active cri-o

apt-get update -y
Ref: https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/
apt-get install -y apt-transport-https ca-certificates curl gpg
curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.33/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.33/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list
apt-get update
apt-get install -y kubelet kubeadm kubectl




Step-5: kubeadm init  or kubeadm init --ignore-preflight-errors=all

or kubeadm init --apiserver-advertise-address=192.168.1.2   ## This is required if server has multiple NIC and you want to use specific IP with API server

crictl ps    # to see all 4 componenets containers are runing 
crictl images



Imp Folder in master node

ls /etc/kubernetes/manifests/   # these are 4 files which controls all 4 master container
ls /etc/kubernetes/pki/		# All certificate are here & mounted from here in containsers
ls /var/lib/kubelet/

kubeadm: It is a installation utility 

kubelet: It is service / agent across all nodes.

kubectl: command cli talk to api..required on master node.

To login into api we need 
API IP | USER Name | PWD

Here all 4 container are bind with the host network hence API IP will be master host interface IP itself.

netstat -tunlp | grep -i api  # to check API server port & IP


and default super user name / PWD will kept in ...  ls -l /etc/kubernetes/admin.conf


cat /etc/kubernetes/admin.conf | grep -i user
    user: kubernetes-admin
users:
  user:


cat /etc/kubernetes/admin.conf | grep -i server
    server: https://10.150.50.180:6443


mkdir .kube

cp /etc/kubernetes/admin.conf .kube/config

kubectl get nodes
kubectl get pod -A






